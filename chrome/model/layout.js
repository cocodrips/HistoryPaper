// Generated by CoffeeScript 1.6.3
(function() {
  this.Layout = (function() {
    function Layout(histories) {
      this.histories = histories;
      this.aspect = 1.4;
      this.clusterNum = histories ? histories.length : 0;
      this.squareSize = 0;
      this.rows = 0;
      this.cols = 0;
    }

    Layout.prototype.drawArticles = function() {
      var h, w;
      w = window.innerWidth - (40 + 300);
      h = window.innerHeight - 100;
      $("#container").css("height", h + "px");
      return this.arrangeArticles(this.histories);
    };

    Layout.prototype.calcSquareSize = function(width, height) {
      var cols, rectangleWidth, rows, squareSize;
      rectangleWidth = width / this.aspect;
      squareSize = height;
      cols = 0;
      rows = 1;
      while (cols * rows < this.clusterNum) {
        cols++;
        squareSize = height / cols;
        rows = Math.round(rectangleWidth / squareSize);
      }
      this.cols = cols;
      this.rows = rows;
      return this.squareSize = squareSize;
    };

    Layout.prototype.setPositionInfo2Histories = function(w) {
      var articleHeight, articleWidth, c, obj, r, _i, _j, _ref, _ref1;
      articleHeight = this.squareSize;
      articleWidth = this.squareSize * this.aspect;
      for (c = _i = 0, _ref = this.cols; 0 <= _ref ? _i < _ref : _i > _ref; c = 0 <= _ref ? ++_i : --_i) {
        for (r = _j = 0, _ref1 = this.rows; 0 <= _ref1 ? _j < _ref1 : _j > _ref1; r = 0 <= _ref1 ? ++_j : --_j) {
          obj = this.histories[(c * this.rows) + r];
          if (obj) {
            obj.left = r * articleWidth;
            obj.top = c * articleHeight;
            obj.width = articleWidth;
            obj.height = articleHeight;
          }
        }
      }
      return this.histories[1];
    };

    Layout.prototype.arrangeArticles = function(histories) {
      var articles, content_header_height;
      console.log(histories);
      articles = d3.select("#main-container").selectAll("article").data(histories).enter().append("article").attr("class", "article").style("width", function(d) {
        return d.rect.width + "px";
      }).style("height", function(d) {
        return d.rect.height + "px";
      }).style("top", function(d) {
        return d.rect.top + "px";
      }).style("left", function(d) {
        return d.rect.left + "px";
      }).append("div").attr("class", "article-inner");
      articles.append("h2").text(function(d) {
        return d.title;
      });
      articles.append("div").attr("class", "url").text(function(d) {
        return d.url;
      });
      articles.append("img").attr("src", function(d) {
        return d.imageurl;
      });
      content_header_height = 150;
      return articles.append("div").attr("class", "content").text(function(d) {
        return d.content;
      }).style("height", function(d) {
        return Math.max(d.rect.height - content_header_height, 0) + "px";
      });
    };

    return Layout;

  })();

}).call(this);
